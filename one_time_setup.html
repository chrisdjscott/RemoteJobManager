
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>One-time setup &#8212; RemoteJobManager 0.4.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="Getting started" href="getting_started.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="one-time-setup">
<h1>One-time setup<a class="headerlink" href="#one-time-setup" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#remote-machine" id="id1">Remote machine</a></p>
<ul>
<li><p><a class="reference internal" href="#globus-guest-collection" id="id2">Globus Guest Collection</a></p></li>
<li><p><a class="reference internal" href="#funcx-endpoint" id="id3">funcX endpoint</a></p></li>
</ul>
</li>
</ul>
</div>
<p>This guide has been tested with NeSI as the remote.</p>
<p>A Globus account is required: <a class="reference external" href="https://app.globus.org/">https://app.globus.org/</a> (you can usually use
your institutional account to authenticate, e.g. University of Auckland).</p>
<section id="remote-machine">
<h2>Remote machine<a class="headerlink" href="#remote-machine" title="Permalink to this headline">¶</a></h2>
<section id="globus-guest-collection">
<h3>Globus Guest Collection<a class="headerlink" href="#globus-guest-collection" title="Permalink to this headline">¶</a></h3>
<p>On the remote machine (e.g. NeSI), you need to have a Globus Guest Collection.
In Globus terminology, a <em>Collection</em> is a set of files and/or directories
that can be shared via Globus. In this section we are sharing a specific
directory on the remote machine, via Globus, so that the RJM tool can upload
and downloads files to and from that directory. You should roughly follow the
steps below to set this up.</p>
<p><strong>Note:</strong> you must have write access to the Guest Collection. On NeSI, this
means you should create the shared directory on the <em>nobackup</em> file system.</p>
<ol class="arabic">
<li><p>Open the <a class="reference external" href="https://app.globus.org/file-manager">Globus Web App file manager</a></p></li>
<li><p>Connect to the “NeSI Wellington DTN V5” <em>Collection</em> (requires NeSI 2 factor
authentication)</p>
<a class="reference external image-reference" href="_static/images/rjm_endpoint_auth.png"><img alt="_images/rjm_endpoint_auth.png" src="_images/rjm_endpoint_auth.png" /></a>
</li>
<li><p>Create and/or navigate to the directory you wish to use for remote jobs (on
NeSI, it must be under <em>/nesi/nobackup/…</em>); and select the <em>Share</em>, then
<em>Continue</em> on the “Authentication/Consent Required” page, if necessary</p>
<a class="reference external image-reference" href="_static/images/rjm_share_dir.png"><img alt="_images/rjm_share_dir.png" src="_images/rjm_share_dir.png" /></a>
</li>
<li><p>On the share settings page, select <em>Add a Guest Collection</em></p>
<a class="reference external image-reference" href="_static/images/01_sharescreen.png"><img alt="_images/01_sharescreen.png" src="_images/01_sharescreen.png" /></a>
</li>
<li><p>On the <em>Create New Guest Collection</em> page, make sure the <em>Directory</em> path
is correct and give the collection a name (also make a note of the
<em>Directory</em> as this will be required during <a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a>)</p>
<a class="reference external image-reference" href="_static/images/rjm_create_guest_collection.png"><img alt="_images/rjm_create_guest_collection.png" src="_images/rjm_create_guest_collection.png" /></a>
</li>
<li><p>Make a note of the guest collection <em>Endpoint UUID</em> as this will be
required during <a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a></p>
<a class="reference external image-reference" href="_static/images/rjm_globus_endpoint_id.png"><img alt="_images/rjm_globus_endpoint_id.png" src="_images/rjm_globus_endpoint_id.png" /></a>
</li>
</ol>
</section>
<section id="funcx-endpoint">
<h3>funcX endpoint<a class="headerlink" href="#funcx-endpoint" title="Permalink to this headline">¶</a></h3>
<p>A <a class="reference external" href="https://funcx.readthedocs.io/en/latest/">funcX</a> endpoint is also required on the remote machine. This allows us to
run commands on the remote system.</p>
<p>On NeSI, first connect to a Mahuika login node. For example, using MobaXterm,
JupyterLab or similar.</p>
<p><strong>Note</strong>: if connecting via the JupyterLab terminal, make sure to <em>ssh</em> to a
login node first, otherwise the funcX endpoint will be killed when your
Jupyter session times out.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the following should be run on a mahuika login node:</span>
<span class="c1">#   (if using jupyter terminal, run</span>
<span class="c1">#    &quot;ssh login.mahuika.nesi.org.nz before continuing&quot;)</span>

<span class="c1"># load funcx endpoint software into the environment</span>
ml purge
ml funcx-endpoint

<span class="c1"># first time setup for funcx, will ask you to authenticate with</span>
<span class="c1"># Globus and copy a code back to the terminal</span>
funcx-endpoint configure

<span class="c1"># start the default endpoint</span>
funcx-endpoint start

<span class="c1"># verify the endpoint is running and obtain the endpoint id</span>
funcx-endpoint list
</pre></div>
</div>
<p>Make a note of the <em>Endpoint ID</em> that shows up in the list command, you will
need it during <a class="reference internal" href="configuration.html"><span class="doc">Configuration</span></a>. The output from list will look something
like follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>+---------------+---------+--------------------------------------+
<span class="p">|</span> Endpoint Name <span class="p">|</span> Status  <span class="p">|</span>             Endpoint ID              <span class="p">|</span>
+<span class="o">===============</span>+<span class="o">=========</span>+<span class="o">======================================</span>+
<span class="p">|</span> default       <span class="p">|</span> Running <span class="p">|</span> ffd77d5c-b65f-4479-bbc3-66a2f7346858 <span class="p">|</span>
+---------------+---------+--------------------------------------+
</pre></div>
</div>
<p>Note: we are effectively just using funcX as a Slurm API (running Slurm commands
on the remote machine), so the <em>default</em> endpoint running on a login node is
entirely appropriate and sufficient.</p>
<p>Also note: after running the above commands, it is safe to close the
window, SSH connection, Jupyter session, etc. - funcX daemonises the process
running the endpoint so it is no longer attached to the running session.</p>
<p>It may sometimes be necessary to restart the endpoint, for example if the
login node was rebooted or some other issue occurred. The following would
achieve this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># the following should be run on a mahuika login node:</span>
<span class="c1">#   (if using jupyter terminal, run</span>
<span class="c1">#    &quot;ssh login.mahuika.nesi.org.nz before continuing&quot;)</span>

<span class="c1"># load funcx endpoint software into the environment</span>
ml purge
ml funcx-endpoint

<span class="c1"># restart the default endpoint</span>
funcx-endpoint restart

<span class="c1"># verify the endpoint is running</span>
funcx-endpoint list
</pre></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">RemoteJobManager</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="getting_started.html">Getting started</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">One-time setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="using_rjm.html">Using RJM</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="getting_started.html">Getting started</a><ul>
      <li>Previous: <a href="getting_started.html" title="previous chapter">Getting started</a></li>
      <li>Next: <a href="installation.html" title="next chapter">Installation</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, The University of Auckland.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/one_time_setup.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>